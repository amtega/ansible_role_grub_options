---
# Tasks for tesing role grub configuration

- name: test grub configuration role
  hosts: all
  become_method: sudo
  become_user: root
  become: yes
  roles:
    - amtega.kernel_params
  vars:
    grub_options_to_be_present:
      - "net.ifnames=0"
      - "biosdevname=0"

    grub_options_to_be_absent:
      - "rhgb"
      - "quiet"

  tasks:
      - name: read grub config file
        # become: yes
        shell: "cat {{ grub_config_file_v1 }}"
        when: >
          ansible_os_family == "RedHat" and
          ansible_distribution_major_version <= 6
        register: read_grub_config_result

      - name: read grub config file
        #become: yes
        shell: "cat {{ grub_config_file_v2 }}"
        when: >
          ansible_os_family == "RedHat" and
          ansible_distribution_major_version > 6
        register: read_grub_config_result

      - name: verify options to be present at Grub config file
        assert:
          that:
            - read_grub_config_result.stdout.find( "{{ item }}" ) != -1
        with_items: "{{ grub_options_to_be_present }}"

      - name: verify options to be absent
        assert:
            that:
              - read_grub_config_result.stdout.find( "{{ item }}" ) ==-1
        with_items:  "{{ grub_options_to_be_absent }}"

  tags:
    - idempotence
